综合需求分析

1. 项目目标与愿景 (Project Goal & Vision)

- 目标用户: 需要定期处理和汇总来自微信聊天的、格式固定的Excel财报文件的个人用户（如项目经理、业务负责人等）。
- 用户痛点: 手动查找、打开、复制、粘贴、汇总多个Excel文件中的数据，过程繁琐、耗时且容易出错。
- 产品愿景: 提供一个轻量、高效、安全的工具，将上述重复性劳动自动化，用户只需几次点击即可完成所有财报数据的汇总与核对，解放生产力。
  
2. 功能性需求详述 (Functional Requirements Specification)

我们将功能需求分解为用户可以直接感知的模块。

FR-1: 核心数据处理模块

这是小程序的引擎，处理从文件到数据的转化过程。

需求ID
需求名称
详细描述
优先级
备注/验收标准
FR-1.1
文件选择与导入
用户可以从微信聊天记录中选择一个或多个文件。小程序应能接收这些文件以供后续处理。

高 (P0)

1. 界面上必须有明确的入口触发文件选择功能。 <br>2. 调起微信原生接口 wx.chooseMessageFile。 <br>3. 支持用户一次性选择多个文件。
FR-1.2
文件名解析与日期提取
小程序根据用户预设的规则（带捕获组的正则表达式），不仅用于校验文件名，更重要的是从中提取出该笔记录的精确日期（年、月、日），作为该条记录的时间戳。
高 (P0)
1. 默认规则升级：默认规则应能解析 x月x日财报.xlsx 格式，并从中提取出“月”和“日”。例如，从 8月5日财报.xlsx 中提取出 month=8, day=5。<br>2. 年份处理逻辑：当文件名中不包含年份时，系统应自动使用当前年份来补全日期。例如，在2024年处理 8月5日财报.xlsx，记录的日期应为 2024-08-05。<br>3. 日期有效性校验：提取出的日期必须是有效日期（如不能是13月或32日）。若提取出的日期无效，该文件应被视为解析失败，并向用户提示。<br>4. 严格匹配：对于不符合规则的文件，系统应自动忽略，并可向用户提供反馈（如“已忽略N个格式不符的文件”）。<br>5. 自定义提取规则：匹配和提取的规则支持在“设置”中由用户自定义（详见 FR-4.1）。<br>6. 数据关联：提取出的日期将直接作为该条明细记录的“日期”字段，用于后续的排序、展示和筛选。
FR-1.3
文件内容解析
小程序需要能够打开并读取 .xlsx 和 .xls 格式的Excel文件内容。
高 (P0)
1. 成功集成第三方Excel解析库。 <br>2. 能够正确解析包含中文、数字、特殊字符的单元格。 <br>3. 文件解析失败时（如文件已损坏），应能捕获异常并提示用户“XX文件解析失败”。
FR-1.4
目标数据提取
小程序根据用户预设的行号和列号，从解析后的文件中精确定位并提取目标单元格的数据。
高 (P0)
1. 默认读取 C2（第2行第3列）单元格。 <br>2. 行号和列号支持在“设置”中由用户自定义。
FR-1.5
数据清洗与转换
对提取到的单元格数据进行处理，确保其为可计算的纯数字。
高 (P0)
1. 如果单元格内容为纯数字或可转换为数字的文本（如 "12345.67"），则直接使用该数字。 <br>2. 如果单元格为空、内容为非数字文本（如“暂无”），则按 0 处理。 <br>3. 应能处理带千分位逗号的数字字符串（如 "10,000" -> 10000）。
FR-1.6
数据去重机制

防止同一份财报文件被重复统计。
高 (P0)
1. 以**文件名**作为唯一标识。 <br>2. 在导入新文件时，检查其文件名是否已存在于历史记录中。 <br>3. 若文件名已存在，则忽略该文件，不进行累加，并可向用户提供反馈（如“已跳过N个重复文件”）。


FR-2: 数据展示与管理模块

这是用户与数据交互的核心界面。

需求ID
需求名称
详细描述
优先级
备注/验收标准
FR-2.1
总金额仪表盘
在小程序主页最醒目的位置，实时显示所有已统计记录的累计总金额。
高 (P0)
1. 总金额应在每次数据变动（增、删）后自动更新。 <br>2. 数字格式化显示，例如使用千分位分隔符（1,234,567.89）。 <br>3. 总金额会根据下方的时间筛选器动态变化。
FR-2.2
明细列表展示
在主页展示所有资金变动的详细记录列表，作为“日志”供用户核对。
高 (P0)
1. 列表按日期**降序**排列（最新的在最上方）。 <br>2. 每条记录清晰展示：**日期、金额、来源/描述**。 <br>3. 金额为正数时可使用一种颜色（如绿色），负数时使用另一种颜色（如红色）。 <br>4. 来源/描述应清晰区分是来自文件（显示文件名）还是手动录入（显示用户填写的描述）。
FR-2.3
记录删除功能
用户可以删除任意一条历史记录。
高 (P0)
1. 用户可通过左滑等手势操作，呼出“删除”按钮。 <br>2. 删除前应有二次确认弹窗，防止误操作（例如“确认删除这条来自[文件名/描述]的记录吗？”）。 <br>3. 删除记录后，总金额和明细列表必须同步更新。
FR-2.4
按时间范围筛选
用户可以按预设的时间范围（本月、本季度、本年、全部）来查看统计数据。
中 (P1)
1. 主界面提供清晰的筛选器选项（如Tabs或分段选择器）。 <br>2. 选择一个范围后，上方的**总金额**和下方的**明细列表**都只显示该时间范围内的数据。 <br>3. 默认显示“全部”。

FR-3: 手动调整模块

提供数据修正和补充的灵活性。

需求ID
需求名称
详细描述
优先级
备注/验收标准
FR-3.1
手动添加记录
允许用户不通过Excel，直接手动录入一笔资金变动。用于处理特殊情况或修正。
中 (P1)

1. 提供一个入口（如“+”按钮的子选项）。 <br>2. 弹出的表单需要包含：**日期选择器、金额输入框、描述输入框**。 <br>3. 金额支持输入正数和负数。 <br>4. 提交后，该记录将和其他记录一样显示在明细列表中，并计入总金额。


---

FR-4: 系统配置模块

让小程序适应用户个性化的工作流程。

需求ID
需求名称
详细描述
优先级
备注/验收标准
FR-4.1
自定义文件名规则
用户可以修改用于识别财报文件的文件名匹配规则。
中 (P1)
1. “设置”页提供一个输入框用于填写正则表达式。 <br>2. 提供清晰的说明文字，告知用户如何填写，并给出一个示例。 <br>3. 保存后，新的规则立即生效，用于下一次的文件导入。
FR-4.2
自定义数据单元格
用户可以修改需要提取数据的单元格位置（行号和列号）。
高 (P0)
1. “设置”页提供两个数字输入框，分别用于填写“行号”和“列号”。 <br>2. 用户输入的是基于1的、符合直觉的行列号（例如第2行第3列）。 <br>3. 保存后，新的位置配置立即生效，用于下一次的文件导入。
FR-4.3
恢复默认设置
用户可以将所有配置一键恢复到初始状态。
低 (P2)
1. “设置”页提供一个“恢复默认”按钮。 <br>2. 点击后有二次确认，防止误操作。


---

3. 非功能性需求 (Non-Functional Requirements)

需求ID
需求类别
详细描述
NFR-1
易用性 (Usability)
整体操作流程应简洁明了，核心功能（添加文件、查看总览）能在3次点击内完成。UI设计应清晰、无歧义。
NFR-2
性能 (Performance)
单个1MB以内的Excel文件，从选择到解析完成并更新UI，应在3秒内完成。列表滚动应保持流畅。
NFR-3
可靠性 (Reliability)
数据计算必须100%准确。数据持久化存储，应用在被微信“杀死”后重启，数据不丢失。
NFR-4
安全性与隐私 (Security & Privacy)
所有Excel文件内容和提取的数据**仅在用户手机本地处理和存储**，绝不上传到任何服务器。这是对用户财务数据安全的基本承诺。


4. 其他需求
界面需求：
必须使用 TDesign Weixin 这个现成的界面工具包来做，让小程序的按钮、列表、输入框等看起来风格统一、简洁、好看。(参考:`https://tdesign.tencent.com/miniprogram/getting-started`)